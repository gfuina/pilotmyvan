import mongoose from 'mongoose';
import { config } from 'dotenv';
import { fileURLToPath } from 'url';
import { dirname, join } from 'path';

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);

// Load environment variables from .env
const envPath = join(__dirname, '../.env');
config({ path: envPath });

// Connect to MongoDB
await mongoose.connect(process.env.MONGODB_URI);
console.log('‚úÖ Connected to MongoDB');

// Define schemas
const EquipmentSchema = new mongoose.Schema({
  name: String,
  description: String,
  categoryId: mongoose.Schema.Types.ObjectId,
  vehicleBrands: [mongoose.Schema.Types.ObjectId],
  equipmentBrands: [mongoose.Schema.Types.ObjectId],
  photos: [String],
  manuals: [{
    title: String,
    url: String,
    isExternal: Boolean,
  }],
  notes: String,
  isUserContributed: Boolean,
  contributedBy: mongoose.Schema.Types.ObjectId,
  status: String,
  approvedBy: mongoose.Schema.Types.ObjectId,
  approvedAt: Date,
  rejectionReason: String,
}, { timestamps: true });

const MaintenanceSchema = new mongoose.Schema({
  equipmentId: mongoose.Schema.Types.ObjectId,
  name: String,
  type: String,
  priority: String,
  difficulty: String,
  recurrence: {
    time: {
      value: Number,
      unit: String,
    },
    kilometers: Number,
  },
  conditions: [String],
  description: String,
  instructions: String,
  photos: [String],
  videos: [String],
  parts: [{
    name: String,
    reference: String,
    quantity: Number,
    estimatedCost: Number,
    purchaseLink: String,
  }],
  estimatedDuration: Number,
  estimatedCost: Number,
  tags: [String],
  isOfficial: Boolean,
  source: String,
  isUserContributed: Boolean,
  contributedBy: mongoose.Schema.Types.ObjectId,
  status: String,
}, { timestamps: true });

const Equipment = mongoose.models.Equipment || mongoose.model('Equipment', EquipmentSchema);
const Maintenance = mongoose.models.Maintenance || mongoose.model('Maintenance', MaintenanceSchema);

try {
  const equipments = [];
  const allMaintenances = [];

  // IDs des cat√©gories
  const categoryBouteillesGaz = new mongoose.Types.ObjectId('68f35042be04ebdaad786b54');
  const categoryDetendeur = new mongoose.Types.ObjectId('68f35042be04ebdaad786b56');
  const categoryTuyauterieGaz = new mongoose.Types.ObjectId('68f35042be04ebdaad786b58');
  const categoryControleEtancheite = new mongoose.Types.ObjectId('68f35042be04ebdaad786b5a');

  // ============================================
  // 1. BOUTEILLES DE GAZ
  // ============================================
  
  const bouteillesGaz = await Equipment.create({
    name: 'Bouteilles de gaz (Propane/Butane)',
    description: 'R√©servoirs de gaz GPL (butane ou propane) pour l\'alimentation des appareils √† gaz du v√©hicule : chauffage, cuisson, r√©frig√©rateur. Capacit√© standard : 6kg, 10kg ou 13kg. Le propane est pr√©f√©rable pour l\'hiver (utilisable jusqu\'√† -40¬∞C vs 0¬∞C pour le butane).',
    categoryId: categoryBouteillesGaz,
    vehicleBrands: [],
    equipmentBrands: [],
    photos: [],
    manuals: [],
    notes: 'Propane = hiver, Butane = √©t√©. V√©rifier la r√©glementation du pays pour le transport et l\'utilisation.',
    isUserContributed: false,
    status: 'approved',
  });
  equipments.push(bouteillesGaz);

  const maintenancesBouteilles = [
    {
      equipmentId: bouteillesGaz._id,
      name: 'Inspection visuelle des bouteilles',
      type: 'inspection',
      priority: 'important',
      difficulty: 'easy',
      recurrence: {
        time: {
          value: 6,
          unit: 'months',
        },
      },
      conditions: [
        'Avant chaque remplissage',
        'Apr√®s choc ou chute',
        'Si suspicion de corrosion',
      ],
      description: 'Contr√¥le visuel de l\'√©tat des bouteilles de gaz pour d√©tecter corrosion, chocs ou dommages.',
      instructions: '1. Inspecter visuellement chaque bouteille :\n   - Absence de rouille, corrosion\n   - Pas de bosses, d√©formations\n   - √âtat du rev√™tement de peinture\n   - Lisibilit√© de l\'√©tiquetage\n2. V√©rifier les robinets :\n   - Pas de fuite au niveau du robinet\n   - Man≈ìuvre fluide (ouverture/fermeture)\n   - Pas de d√©formation du volant\n3. Contr√¥ler la date de derni√®re √©preuve :\n   - Grav√©e sur la bouteille\n   - Bouteilles de +10 ans = √† remplacer ou r√©prouver\n4. V√©rifier le joint du robinet\n5. Tester la pr√©sence de fuite (eau savonneuse)\n\n‚ö†Ô∏è Ne jamais utiliser une bouteille endommag√©e\n‚ö†Ô∏è Bouteilles rouill√©es = danger',
      photos: [],
      videos: [],
      parts: [],
      estimatedDuration: 10,
      estimatedCost: 0,
      tags: ['Gaz', 'S√©curit√©', 'Inspection', 'GPL'],
      isOfficial: true,
      source: 'Norme NF EN 1949',
      isUserContributed: false,
      status: 'approved',
    },
    {
      equipmentId: bouteillesGaz._id,
      name: 'V√©rification du serrage et fixation',
      type: 'inspection',
      priority: 'important',
      difficulty: 'easy',
      recurrence: {
        time: {
          value: 3,
          unit: 'months',
        },
      },
      conditions: [
        'Apr√®s chaque changement de bouteille',
        'Apr√®s conduite sur piste',
        'Si bruits suspects',
      ],
      description: 'Contr√¥le de la fixation des bouteilles dans leur coffre pour √©viter tout mouvement en roulant.',
      instructions: '1. V√©rifier le syst√®me de fixation :\n   - Sangles de maintien serr√©es\n   - Cales bien positionn√©es\n   - Absence de jeu\n2. Tester la stabilit√© :\n   - Bouteilles ne doivent pas bouger\n   - Pas de mouvement lat√©ral\n3. V√©rifier l\'a√©ration du coffre :\n   - Grilles de ventilation d√©gag√©es\n   - Pas d\'obstruction\n   - √âvacuation vers l\'ext√©rieur fonctionnelle\n4. Contr√¥ler la propret√© du coffre\n5. V√©rifier que les bouteilles sont en position verticale\n\n‚ö†Ô∏è Les bouteilles doivent TOUJOURS √™tre en position verticale\n‚ö†Ô∏è Le coffre DOIT √™tre ventil√© (gaz plus lourd que l\'air)',
      photos: [],
      videos: [],
      parts: [],
      estimatedDuration: 10,
      estimatedCost: 0,
      tags: ['Fixation', 'S√©curit√©', 'Gaz'],
      isOfficial: true,
      source: 'Bonnes pratiques GPL',
      isUserContributed: false,
      status: 'approved',
    },
    {
      equipmentId: bouteillesGaz._id,
      name: 'Test de d√©tection de fuite',
      type: 'test',
      priority: 'critical',
      difficulty: 'easy',
      recurrence: {
        time: {
          value: 3,
          unit: 'months',
        },
      },
      conditions: [
        'Apr√®s chaque changement de bouteille',
        'Si odeur de gaz',
        'Apr√®s toute intervention sur le circuit',
      ],
      description: 'D√©tection de fuites au niveau des robinets, raccords et d√©tendeur pour pr√©venir tout risque d\'explosion ou d\'intoxication.',
      instructions: '‚ö†Ô∏è TEST DE S√âCURIT√â CRITIQUE\n\n1. Pr√©parer une solution d\'eau savonneuse (liquide vaisselle)\n2. Ouvrir le robinet de la bouteille\n3. Appliquer l\'eau savonneuse sur :\n   - Le robinet de la bouteille\n   - Le raccord bouteille/d√©tendeur\n   - Les joints\n   - Le d√©tendeur\n4. Observer pendant 30 secondes\n5. Si bulles = FUITE :\n   - Fermer imm√©diatement le robinet\n   - A√©rer la zone\n   - Identifier et corriger la fuite\n   - Remplacer le joint si n√©cessaire\n6. Retester apr√®s correction\n\nüö® DANGER : Ne JAMAIS utiliser de flamme pour d√©tecter une fuite\n‚ö†Ô∏è En cas de fuite importante : √©vacuer et appeler les secours',
      photos: [],
      videos: [],
      parts: [
        {
          name: 'Joint de robinet de bouteille',
          reference: 'Universel',
          quantity: 2,
          estimatedCost: 3,
        },
      ],
      estimatedDuration: 15,
      estimatedCost: 3,
      tags: ['Fuite', 'S√©curit√©', 'Test', 'Critical', 'Gaz'],
      isOfficial: true,
      source: 'Norme NF EN 1949',
      isUserContributed: false,
      status: 'approved',
    },
    {
      equipmentId: bouteillesGaz._id,
      name: 'Remplacement des joints de robinet',
      type: 'replacement',
      priority: 'important',
      difficulty: 'easy',
      recurrence: {
        time: {
          value: 2,
          unit: 'years',
        },
      },
      conditions: [
        'Si fuite d√©tect√©e',
        'Lors du changement de bouteille si joint ab√Æm√©',
        'Pr√©ventivement tous les 2 ans',
      ],
      description: 'Remplacement pr√©ventif des joints d\'√©tanch√©it√© entre bouteille et d√©tendeur.',
      instructions: '1. Fermer le robinet de la bouteille\n2. D√©visser le d√©tendeur\n3. Retirer l\'ancien joint\n4. Nettoyer la surface de contact\n5. Installer le nouveau joint :\n   - V√©rifier qu\'il est adapt√© (butane/propane)\n   - Le positionner correctement\n   - Ne pas graisser\n6. Revisser le d√©tendeur √† la main (ne pas forcer)\n7. Ouvrir l√©g√®rement le robinet\n8. Tester l\'√©tanch√©it√© (eau savonneuse)\n9. Si fuite : resserrer l√©g√®rement\n10. Retester\n\nüí° Avoir toujours des joints de rechange',
      photos: [],
      videos: [],
      parts: [
        {
          name: 'Joints de robinet bouteille (lot de 5)',
          reference: 'Universel GPL',
          quantity: 1,
          estimatedCost: 5,
        },
      ],
      estimatedDuration: 15,
      estimatedCost: 5,
      tags: ['Joint', '√âtanch√©it√©', 'Remplacement'],
      isOfficial: true,
      source: 'Bonnes pratiques GPL',
      isUserContributed: false,
      status: 'approved',
    },
  ];

  allMaintenances.push(...maintenancesBouteilles);

  // ============================================
  // 2. D√âTENDEUR
  // ============================================
  
  const detendeur = await Equipment.create({
    name: 'D√©tendeur de gaz',
    description: 'R√©gulateur de pression qui r√©duit la pression du gaz de la bouteille (variable) √† une pression constante utilisable par les appareils (30 ou 37 mbar). Essentiel pour la s√©curit√© et le bon fonctionnement des √©quipements. Types : d√©tendeur simple, inverseur automatique 2 bouteilles, d√©tendeur r√©glable.',
    categoryId: categoryDetendeur,
    vehicleBrands: [],
    equipmentBrands: [],
    photos: [],
    manuals: [],
    notes: 'Dur√©e de vie : 10 ans maximum. V√©rifier la compatibilit√© butane/propane.',
    isUserContributed: false,
    status: 'approved',
  });
  equipments.push(detendeur);

  const maintenancesDetendeur = [
    {
      equipmentId: detendeur._id,
      name: 'Remplacement du d√©tendeur',
      type: 'replacement',
      priority: 'critical',
      difficulty: 'easy',
      recurrence: {
        time: {
          value: 10,
          unit: 'years',
        },
      },
      conditions: [
        'Obligatoire apr√®s 10 ans',
        'Si dysfonctionnement d√©tect√©',
        'Si d√©bit irr√©gulier',
        'Si givrage r√©p√©t√©',
      ],
      description: 'Remplacement obligatoire du d√©tendeur tous les 10 ans maximum selon la r√©glementation fran√ßaise.',
      instructions: '‚ö†Ô∏è REMPLACEMENT OBLIGATOIRE APR√àS 10 ANS\n\n1. Fermer le robinet de la bouteille\n2. Purger le circuit (allumer un feu jusqu\'√† extinction)\n3. D√©visser l\'ancien d√©tendeur\n4. V√©rifier la date de fabrication (grav√©e dessus)\n5. Choisir le bon d√©tendeur :\n   - 30 mbar (norme fran√ßaise ancienne)\n   - 37 mbar (norme europ√©enne actuelle)\n   - Propane/Butane selon utilisation\n   - D√©bit adapt√© aux appareils\n6. Installer le nouveau d√©tendeur\n7. V√©rifier le joint (neuf fourni)\n8. Serrer √† la main (pas de cl√©)\n9. Ouvrir le robinet progressivement\n10. Tester l\'√©tanch√©it√© (eau savonneuse)\n11. V√©rifier le bon fonctionnement des appareils\n\nüí° Noter la date d\'installation sur le d√©tendeur',
      photos: [],
      videos: [],
      parts: [
        {
          name: 'D√©tendeur 37 mbar propane/butane',
          reference: 'Conforme NF',
          quantity: 1,
          estimatedCost: 25,
        },
      ],
      estimatedDuration: 20,
      estimatedCost: 25,
      tags: ['D√©tendeur', 'Remplacement', 'Obligatoire', 'S√©curit√©'],
      isOfficial: true,
      source: 'Norme NF EN 12864',
      isUserContributed: false,
      status: 'approved',
    },
    {
      equipmentId: detendeur._id,
      name: 'V√©rification du fonctionnement du d√©tendeur',
      type: 'test',
      priority: 'important',
      difficulty: 'easy',
      recurrence: {
        time: {
          value: 6,
          unit: 'months',
        },
      },
      conditions: [
        'Si flammes irr√©guli√®res',
        'Si appareils ne fonctionnent pas correctement',
        'Si givrage du d√©tendeur',
      ],
      description: 'Contr√¥le du bon fonctionnement du d√©tendeur et d√©tection d\'anomalies.',
      instructions: '1. Allumer un appareil √† gaz (cuisini√®re)\n2. Observer la flamme :\n   - Doit √™tre bleue et stable\n   - Pas de clignotement\n   - Pas de sifflement anormal\n3. V√©rifier le d√©tendeur :\n   - Pas de givrage excessif (l√©ger givrage = normal)\n   - Pas de sifflement\n   - Pas de vibration\n4. Tester avec plusieurs appareils simultan√©ment\n5. V√©rifier que le d√©bit est suffisant\n6. Contr√¥ler l\'√©tanch√©it√© (eau savonneuse)\n7. V√©rifier la soupape de s√©curit√©\n\nüö® Signes de dysfonctionnement :\n   - Flammes jaunes/orang√©es\n   - Coupures intempestives\n   - Odeur de gaz\n   - Givrage important et permanent\n   ‚Üí Remplacer le d√©tendeur',
      photos: [],
      videos: [],
      parts: [],
      estimatedDuration: 15,
      estimatedCost: 0,
      tags: ['Test', 'D√©tendeur', 'Diagnostic'],
      isOfficial: true,
      source: 'Bonnes pratiques GPL',
      isUserContributed: false,
      status: 'approved',
    },
    {
      equipmentId: detendeur._id,
      name: 'Nettoyage des orifices du d√©tendeur',
      type: 'cleaning',
      priority: 'recommended',
      difficulty: 'easy',
      recurrence: {
        time: {
          value: 1,
          unit: 'years',
        },
      },
      conditions: [
        'Si poussi√®re accumul√©e',
        'Apr√®s stockage prolong√©',
      ],
      description: 'Nettoyage des orifices de ventilation du d√©tendeur pour assurer son bon fonctionnement.',
      instructions: '1. Fermer le robinet de bouteille\n2. Inspecter visuellement le d√©tendeur\n3. Nettoyer d√©licatement :\n   - Les orifices de ventilation\n   - La membrane (si accessible)\n   - Utiliser une brosse douce\n   - Souffler avec de l\'air comprim√© (faible pression)\n4. Ne JAMAIS d√©monter le d√©tendeur\n5. V√©rifier l\'absence de toile d\'araign√©e\n6. Contr√¥ler l\'√©tat g√©n√©ral\n7. Retester le fonctionnement\n\n‚ö†Ô∏è Ne pas utiliser de produits chimiques\n‚ö†Ô∏è Ne pas d√©monter le d√©tendeur',
      photos: [],
      videos: [],
      parts: [],
      estimatedDuration: 10,
      estimatedCost: 0,
      tags: ['Nettoyage', 'Entretien', 'D√©tendeur'],
      isOfficial: true,
      source: 'Bonnes pratiques GPL',
      isUserContributed: false,
      status: 'approved',
    },
  ];

  allMaintenances.push(...maintenancesDetendeur);

  // ============================================
  // 3. FLEXIBLE ET TUYAUTERIE GAZ
  // ============================================
  
  const tuyauterieGaz = await Equipment.create({
    name: 'Flexible et tuyauterie gaz',
    description: 'Ensemble des conduites et flexibles acheminant le gaz du d√©tendeur aux diff√©rents appareils. Comprend : tuyaux cuivre rigides, flexibles haute pression, raccords rapides. Les flexibles doivent √™tre conformes NF et remplac√©s selon les pr√©conisations (5-10 ans).',
    categoryId: categoryTuyauterieGaz,
    vehicleBrands: [],
    equipmentBrands: [],
    photos: [],
    manuals: [],
    notes: 'Les flexibles ont une dur√©e de vie limit√©e. Date de p√©remption marqu√©e dessus.',
    isUserContributed: false,
    status: 'approved',
  });
  equipments.push(tuyauterieGaz);

  const maintenancesTuyauterie = [
    {
      equipmentId: tuyauterieGaz._id,
      name: 'Remplacement des flexibles gaz',
      type: 'replacement',
      priority: 'critical',
      difficulty: 'intermediate',
      recurrence: {
        time: {
          value: 5,
          unit: 'years',
        },
      },
      conditions: [
        'Obligatoire selon date de p√©remption',
        'Si craquelures visibles',
        'Si durcissement du flexible',
        'Apr√®s 10 ans maximum',
      ],
      description: 'Remplacement obligatoire des flexibles gaz selon leur date de p√©remption (marqu√©e dessus) ou leur √©tat.',
      instructions: '‚ö†Ô∏è REMPLACEMENT OBLIGATOIRE SELON DATE DE P√âREMPTION\n\n1. Fermer le robinet de gaz\n2. Purger le circuit\n3. Identifier tous les flexibles :\n   - Cuisini√®re\n   - R√©frig√©rateur\n   - Chauffage\n4. V√©rifier la date de p√©remption (marqu√©e sur le flexible)\n5. D√©connecter l\'ancien flexible\n6. V√©rifier la compatibilit√© du raccord\n7. Installer le nouveau flexible :\n   - Utiliser uniquement des flexibles NF\n   - Respecter la longueur (max 2m)\n   - √âviter les coudes serr√©s\n   - Ne pas tendre le flexible\n8. Serrer les raccords (2 cl√©s)\n9. Tester l\'√©tanch√©it√© (eau savonneuse)\n10. V√©rifier le fonctionnement de l\'appareil\n11. Noter la date de remplacement\n\nüí° Types de flexibles :\n   - Caoutchouc : 5 ans\n   - Inox : 10 ans\n   - Toujours marqu√©s NF',
      photos: [],
      videos: [],
      parts: [
        {
          name: 'Flexible gaz NF inox 1,5m',
          reference: 'Certification NF',
          quantity: 1,
          estimatedCost: 15,
        },
      ],
      estimatedDuration: 30,
      estimatedCost: 15,
      tags: ['Flexible', 'Remplacement', 'Obligatoire', 'S√©curit√©'],
      isOfficial: true,
      source: 'Norme NF D 36-121',
      isUserContributed: false,
      status: 'approved',
    },
    {
      equipmentId: tuyauterieGaz._id,
      name: 'Inspection des tuyauteries et raccords',
      type: 'inspection',
      priority: 'important',
      difficulty: 'easy',
      recurrence: {
        time: {
          value: 6,
          unit: 'months',
        },
      },
      conditions: [
        'Avant la saison',
        'Apr√®s conduite difficile',
        'Si odeur de gaz',
      ],
      description: 'Contr√¥le visuel et tactile de l\'ensemble de la tuyauterie gaz et des raccords.',
      instructions: '1. Acc√©der √† l\'ensemble du circuit gaz\n2. Inspecter visuellement :\n   - Tuyaux cuivre : pas de choc, d√©formation\n   - Flexibles : pas de craquelure, durcissement\n   - Raccords : pas de corrosion\n3. V√©rifier les fixations :\n   - Colliers de serrage\n   - Supports de tuyauterie\n   - Absence de frottement\n4. Contr√¥ler les raccords rapides\n5. V√©rifier que les tuyaux ne sont pas comprim√©s\n6. Tester l\'√©tanch√©it√© sur tous les raccords\n7. V√©rifier la ventilation du compartiment gaz\n\nüö® Signes d\'alerte :\n   - Flexible craquel√©\n   - Tuyau d√©form√©\n   - Raccord desserr√©\n   - Corrosion visible\n   ‚Üí Intervention imm√©diate',
      photos: [],
      videos: [],
      parts: [],
      estimatedDuration: 25,
      estimatedCost: 0,
      tags: ['Inspection', 'Tuyauterie', 'S√©curit√©'],
      isOfficial: true,
      source: 'Bonnes pratiques GPL',
      isUserContributed: false,
      status: 'approved',
    },
    {
      equipmentId: tuyauterieGaz._id,
      name: 'Test d\'√©tanch√©it√© du circuit complet',
      type: 'test',
      priority: 'critical',
      difficulty: 'intermediate',
      recurrence: {
        time: {
          value: 1,
          unit: 'years',
        },
      },
      conditions: [
        'Apr√®s toute intervention sur le circuit',
        'Si odeur de gaz',
        'Avant contr√¥le r√©glementaire',
      ],
      description: 'Test complet d\'√©tanch√©it√© de l\'ensemble du circuit gaz du v√©hicule.',
      instructions: '‚ö†Ô∏è TEST DE S√âCURIT√â MAJEUR\n\n1. Fermer tous les appareils √† gaz\n2. Ouvrir le robinet de la bouteille\n3. M√©thode 1 - Test √† l\'eau savonneuse :\n   - Pr√©parer eau + liquide vaisselle\n   - Appliquer sur TOUS les raccords\n   - D√©tendeur\n   - Tous les flexibles\n   - Robinets d\'appareils\n   - Observer pendant 1 minute minimum\n4. M√©thode 2 - Test au manom√®tre (pro) :\n   - Mettre le circuit en pression\n   - Connecter un manom√®tre\n   - Observer la pression pendant 15 min\n   - Toute baisse = fuite\n5. Si fuite d√©tect√©e :\n   - Fermer imm√©diatement le gaz\n   - A√©rer\n   - Localiser pr√©cis√©ment\n   - R√©parer ou remplacer\n   - Retester\n6. Documenter les r√©sultats\n\nüö® En cas de fuite importante : faire appel √† un professionnel',
      photos: [],
      videos: [],
      parts: [],
      estimatedDuration: 45,
      estimatedCost: 0,
      tags: ['Test', '√âtanch√©it√©', 'Circuit', 'S√©curit√©', 'Critical'],
      isOfficial: true,
      source: 'Norme NF EN 1949',
      isUserContributed: false,
      status: 'approved',
    },
  ];

  allMaintenances.push(...maintenancesTuyauterie);

  // ============================================
  // 4. CONTR√îLE D'√âTANCH√âIT√â / R√âVISION GAZ
  // ============================================
  
  const controleGaz = await Equipment.create({
    name: 'Installation gaz compl√®te',
    description: 'Ensemble du syst√®me d\'alimentation gaz du v√©hicule, comprenant bouteilles, d√©tendeur, tuyauterie, robinets et appareils. N√©cessite un contr√¥le r√©glementaire p√©riodique par un professionnel agr√©√© selon la norme NF EN 1949.',
    categoryId: categoryControleEtancheite,
    vehicleBrands: [],
    equipmentBrands: [],
    photos: [],
    manuals: [],
    notes: 'Contr√¥le obligatoire tous les 5 ans pour les v√©hicules de loisirs en France (certificat de conformit√©).',
    isUserContributed: false,
    status: 'approved',
  });
  equipments.push(controleGaz);

  const maintenancesControle = [
    {
      equipmentId: controleGaz._id,
      name: 'R√©vision gaz r√©glementaire (Qualigaz)',
      type: 'service',
      priority: 'critical',
      difficulty: 'professional',
      recurrence: {
        time: {
          value: 5,
          unit: 'years',
        },
      },
      conditions: [
        'OBLIGATOIRE tous les 5 ans',
        'Lors d\'une vente du v√©hicule',
        'Apr√®s modification du circuit gaz',
        'Pour certaines assurances',
      ],
      description: 'Contr√¥le r√©glementaire obligatoire de l\'installation gaz par un professionnel agr√©√© Qualigaz ou √©quivalent selon la norme NF EN 1949.',
      instructions: '‚ö†Ô∏è CONTR√îLE OBLIGATOIRE PAR PROFESSIONNEL AGR√â√â\n\nCe contr√¥le DOIT √™tre effectu√© par un organisme agr√©√© :\n- Qualigaz\n- Veritas\n- Bureau de contr√¥le agr√©√©\n\nPoints contr√¥l√©s :\n1. Ventilation du coffre √† bouteilles\n2. √âtat et fixation des bouteilles\n3. D√©tendeur (date, fonctionnement)\n4. Flexibles (date de p√©remption, √©tat)\n5. Tuyauterie rigide\n6. Tous les raccords\n7. Robinets et vannes\n8. Appareils √† gaz\n9. √âvacuation des gaz br√ªl√©s\n10. Test d\'√©tanch√©it√© complet\n11. Ventilation haute et basse\n\nDocuments remis :\n- Certificat de conformit√©\n- Rapport de contr√¥le d√©taill√©\n- Liste des anomalies √©ventuelles\n\nüí° Co√ªt moyen : 80-150‚Ç¨\nüí° Dur√©e : 1-2 heures\nüìÖ Valable 5 ans (noter la date)',
      photos: [],
      videos: [],
      parts: [],
      estimatedDuration: 120,
      estimatedCost: 120,
      tags: ['R√©vision', 'Obligatoire', 'Professionnel', 'Qualigaz', 'R√©glementation'],
      isOfficial: true,
      source: 'Arr√™t√© du 2 ao√ªt 1977 - NF EN 1949',
      isUserContributed: false,
      status: 'approved',
    },
    {
      equipmentId: controleGaz._id,
      name: 'V√©rification de la ventilation gaz',
      type: 'inspection',
      priority: 'critical',
      difficulty: 'easy',
      recurrence: {
        time: {
          value: 6,
          unit: 'months',
        },
      },
      conditions: [
        'Avant chaque saison',
        'Si odeur de gaz persistante',
        'Apr√®s hivernage',
      ],
      description: 'Contr√¥le des ventilations haute et basse obligatoires du compartiment gaz et des zones d\'utilisation.',
      instructions: '‚ö†Ô∏è VENTILATION OBLIGATOIRE (GPL plus lourd que l\'air)\n\n1. Compartiment des bouteilles :\n   - Ventilation BASSE (√©vacuation GPL)\n   - Grille d\'a√©ration d√©gag√©e\n   - √âvacuation vers l\'EXT√âRIEUR\n   - Surface minimale r√©glementaire\n   - Pas d\'obstruction\n2. V√©rifier qu\'il n\'y a pas :\n   - De nid d\'insectes\n   - D\'obstruction\n   - De grille manquante\n3. Zone d\'utilisation des appareils :\n   - Ventilation haute (air vici√©)\n   - Ventilation basse (air frais)\n4. Tester le tirage des appareils\n5. Nettoyer les grilles si n√©cessaire\n\nüö® DANGER : Sans ventilation correcte :\n   - Risque d\'asphyxie (CO)\n   - Risque d\'explosion (accumulation GPL)\n   ‚Üí Ventilation = OBLIGATION L√âGALE',
      photos: [],
      videos: [],
      parts: [],
      estimatedDuration: 20,
      estimatedCost: 0,
      tags: ['Ventilation', 'S√©curit√©', 'Obligatoire', 'CO'],
      isOfficial: true,
      source: 'Norme NF EN 1949',
      isUserContributed: false,
      status: 'approved',
    },
    {
      equipmentId: controleGaz._id,
      name: 'Test du d√©tecteur de gaz',
      type: 'test',
      priority: 'critical',
      difficulty: 'easy',
      recurrence: {
        time: {
          value: 3,
          unit: 'months',
        },
      },
      conditions: [
        'Avant chaque voyage',
        'Apr√®s changement de batterie',
        'Si aucune alerte depuis longtemps',
      ],
      description: 'V√©rification du bon fonctionnement du d√©tecteur de gaz et de CO si √©quip√©.',
      instructions: '1. V√©rifier que le d√©tecteur est aliment√©\n2. Tester le bouton de test :\n   - Appuyer sur le bouton TEST\n   - L\'alarme doit sonner\n   - Le voyant doit s\'allumer\n3. V√©rifier la date de p√©remption du d√©tecteur\n4. Remplacer si :\n   - Plus de 5-7 ans (selon mod√®le)\n   - Ne sonne pas au test\n   - Voyant d√©fectueux\n5. V√©rifier l\'emplacement :\n   - GPL : d√©tecteur BAS (gaz lourd)\n   - CO : d√©tecteur √† hauteur d\'homme\n6. Nettoyer la grille du capteur\n\nüí° Dur√©e de vie d√©tecteur : 5-7 ans\nüö® OBLIGATOIRE pour la s√©curit√©',
      photos: [],
      videos: [],
      parts: [
        {
          name: 'D√©tecteur de gaz GPL',
          reference: 'Certification EN 50194',
          quantity: 1,
          estimatedCost: 40,
        },
      ],
      estimatedDuration: 10,
      estimatedCost: 0,
      tags: ['D√©tecteur', 'Alarme', 'S√©curit√©', 'Test'],
      isOfficial: true,
      source: 'Norme EN 50194',
      isUserContributed: false,
      status: 'approved',
    },
    {
      equipmentId: controleGaz._id,
      name: 'Purge et vidange du circuit gaz (hivernage)',
      type: 'drain',
      priority: 'recommended',
      difficulty: 'easy',
      recurrence: {
        time: {
          value: 1,
          unit: 'years',
        },
      },
      conditions: [
        'Avant stockage prolong√©',
        'En cas de non-utilisation hivernale',
        'Pour s√©curit√© maximale',
      ],
      description: 'Purge compl√®te du circuit gaz avant une p√©riode d\'immobilisation prolong√©e.',
      instructions: '1. Fermer le robinet de la bouteille\n2. Allumer tous les appareils √† gaz\n3. Laisser br√ªler jusqu\'√† extinction compl√®te\n4. V√©rifier que le circuit est bien purg√©\n5. Fermer tous les robinets d\'appareils\n6. Option s√©curit√© maximale :\n   - D√©connecter le d√©tendeur\n   - Sortir les bouteilles du v√©hicule\n   - Stocker dans un local ventil√©\n7. Laisser les robinets ouverts pendant le stockage\n8. Marquer "PURG√â" sur le tableau de bord\n\nüí° Avantages :\n   - S√©curit√© maximale\n   - Pas de risque de fuite\n   - Moins d\'encrassement des injecteurs',
      photos: [],
      videos: [],
      parts: [],
      estimatedDuration: 15,
      estimatedCost: 0,
      tags: ['Purge', 'Hivernage', 'S√©curit√©', 'Stockage'],
      isOfficial: true,
      source: 'Bonnes pratiques GPL',
      isUserContributed: false,
      status: 'approved',
    },
  ];

  allMaintenances.push(...maintenancesControle);

  // ============================================
  // INSERTION EN BASE
  // ============================================

  const insertedMaintenances = await Maintenance.insertMany(allMaintenances);
  console.log(`‚úÖ ${insertedMaintenances.length} maintenances cr√©√©es au total`);

  // ============================================
  // R√âSUM√â
  // ============================================
  
  console.log('\n\nüìä R√âSUM√â DE L\'INSERTION - INSTALLATION GAZ');
  console.log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');
  
  let maintenanceIndex = 0;
  equipments.forEach((eq, i) => {
    const eqMaintenances = allMaintenances.filter(m => m.equipmentId.equals(eq._id));
    console.log(`\nüîß √âQUIPEMENT ${i + 1}: ${eq.name}`);
    console.log(`   ID: ${eq._id}`);
    console.log(`   Maintenances (${eqMaintenances.length}):`);
    eqMaintenances.forEach((m, j) => {
      console.log(`   ${j + 1}. ${m.name} (${m.type} - ${m.priority})`);
    });
  });
  
  console.log('\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');
  console.log(`‚úÖ Total: ${equipments.length} √©quipements, ${allMaintenances.length} maintenances`);
  console.log('\n‚ö†Ô∏è  POINTS DE S√âCURIT√â GAZ :');
  console.log('   ‚Ä¢ R√©vision Qualigaz obligatoire tous les 5 ans');
  console.log('   ‚Ä¢ D√©tendeur √† remplacer tous les 10 ans MAX');
  console.log('   ‚Ä¢ Flexibles selon date de p√©remption (5-10 ans)');
  console.log('   ‚Ä¢ Ventilation obligatoire et fonctionnelle');
  console.log('   ‚Ä¢ D√©tecteur de gaz + CO recommand√©');

} catch (error) {
  console.error('‚ùå Erreur lors de l\'insertion:', error);
} finally {
  await mongoose.disconnect();
  console.log('\n‚úÖ D√©connect√© de MongoDB');
}

